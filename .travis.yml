dist: xenial
sudo: false
language: node_js
node_js:
- '12'
- '10'
- '8'
cache:
  directories:
    - $HOME/.npm
    - node_modules
    - website/node_modules
env:
  global:
  - DOCKER_USERNAME=mnmkng
  - secure: pgwE9Nxa27nwuC0zI+IrbpY/P/QNPL9oNxdwk+LMxa90Tn/5EUKl5D/LblGzjRYd39i/Z1ucNf1OJoKThX7YQxs/de4fjX00HGC0DjRzBRcLsU02HhbrNSA/6ASpWyR2WTxFGnJG/15CzHgqP1BM6EvLJixFoyhk6tnF0kqpJos/h8yfoSZV1kfdlcaz1TQU/NdoFD2Agxm5BEf3/b4SKtXGF0pGGj/IdPCMc/NwsJpHFHi2lU90Nr0WVnHD3wyZRHyasQlGG9Yu/f8Tjf27LCY5QDgcJ/JhsFbwabUwXe98JtTLssriOCajXECilwdBYFTpctIhIgfs6bmdO5Xy3rUjrvdMbOjhjNhkD0UHAQjQg5SUEAo5RKssEUgTUtL4S7P6falc1QwhehZZO/65Ui13Jh1zhlBZpYAO1RXLB7m8DHj4gRrgQswn4qBjWpjbiwfC9ocIuH0b/3QUXRGA4cPjB3G4tl+OdFMFykSYvuZGdWC4U6x+z/C6OfEEYwqJaapHKNnafp9429LMNPzd8SSS3KhDaY7N2kLnH5YaoFAVsZ0rRIk0GZpP+xYWBfFlELqCarvcuZi9su3QWverzecjOpfNu+LCHpOYdiPQtGvm8Mzr1eZun/VaJ5DZ3ZIX1y6ODSCg9b9ikGtcz6A1n2GkE4cHN/B1YI52NIbRXN0=
  - secure: q5jH62AWy4FpOEPmRMWeA3zVcoeGobBzQ1yJ9YrbTOjGAFa6Kd86lS0VUJWtgOwAMycEROCTpEZX+oalVhRaQyR8kikZg7h80wpOziPfWAJe0y3wBfoP1eLaotLF4PhDhSw2X/wo88DGufzYIFOnH4icITYQIaVPe+8an/Nj/I+Hl3UAONEhIIzMTwWAXNz1haNrPGEDN0keva3bPEaMcrK/f1BgkaOTvVFoZRNpsBGaIuQnM9B9eXzoJeXwB0WmWmX/7Pr2DXE4DOWmSA0hfzJUuCmZsudR1+DL5S2gG97ppjBJ/hKIvNusn5/O7tj00lf/LF6hOKgOnWTWFFhrLbMC9pbqt5TbG4D1kCybiZqZmq1P27n5HX2RmjFiUEG2LJ39nnt+UIo+Y01IuL9YtjghvKpCelauBGflhrdZPae2nA6rvikEzLPHuk7qyHiV03hYgom6feR6yv8S1A6PACvBrX1onPvoI4ihv6IOvrQ9l3rzEGxuRyD3QDDL+CT3wvdr0G7NbMRorkgZDCsMBN77mjivcg7H0cqp8b/n7DRo/Ua1lWTHSs95Y2xr8C0DjpISMLcEHzNeZxs46NmZbPzbjuqac3VJW90g3RhMlIJ06MOHp0zAZHdLdJIUTkTjN0d45DHGoETtFinXaRe7tqGqkPt54sQ8c2ZRTU4QZD0=
stages:
- test
- deploy
- images
install:
- npm install --no-package-lock
jobs:
  include:
  - stage: test
    name: 'Lint&Docs'
    script:
      - (cd website && npm install --no-package-lock)
      - npm run lint && node .travis/check-docs.js
  - stage: deploy
    node_js: '10'
    before_deploy: node .travis/before-deploy.js
    after_deploy: node .travis/after-deploy.js
    deploy:
    - provider: npm
      email: ondra@apify.com
      api_key:
        secure: p3U5TFS6bhx0DGS15uMak6M09K+k4YCJ4My2jDDuvXrHMTk7KBIiC9yuCB08SGOWYi/bCTaLgDEFXntKB0rTvR+U6JgVWf/8PAYlWJm4ViqQfk8e8KVfGCZrlT3NAXb2rV2DDidf5F11dbx8iNiw/fw1pmyUKHML+l0rip1N1+SM7BThemfFW7Cp2+0VO+wmRYUVTY34TAe7hkWlA7KQEdUPBCdYmitks90nuciJXJObcDhHXrC0vH7ufTtERjCBIU+ilfjNQAFJuOmD0dD1zxF9iIQlaozNf9DCOklGJWkOEQzn+YWyYinZJdX3JvRpwWSaVQy709dOPNKw7FtVF4NuWkUDz9ajGEZRB0+LPlbN/sqeMkodFoQoV5ogSSZVqX3TzDfnbVIUX2A79yoraSjd4kKftAxKclpIaxu4356W5nnuk9Q6n0uBiFZNCDKK5oJKY3IWAyhN9rZXlu8f/W8JccAQXmwPS8W4AHVnRiFsSgFjKytwKSC8NfTcDnSJJXYMAXvLj8PCWfWq38+9iCYi6ByC3PdvS/Hr7VEf4nxnIRStCX8e7h/9IeYiBeqGx1prLw2MLBwRdBCqVNhobEa6zyx4xXoInGS8qhqseqGAdGjOQuMGWDSLVQmZdi2kjoHnf0/Yz1C4caKM6GaMKl9TvbauHAi78c+Av7XnNCI=
      on:
        branch: master
      tag: beta
      skip_cleanup: true
    - provider: npm
      email: ondra@apify.com
      api_key:
        secure: p3U5TFS6bhx0DGS15uMak6M09K+k4YCJ4My2jDDuvXrHMTk7KBIiC9yuCB08SGOWYi/bCTaLgDEFXntKB0rTvR+U6JgVWf/8PAYlWJm4ViqQfk8e8KVfGCZrlT3NAXb2rV2DDidf5F11dbx8iNiw/fw1pmyUKHML+l0rip1N1+SM7BThemfFW7Cp2+0VO+wmRYUVTY34TAe7hkWlA7KQEdUPBCdYmitks90nuciJXJObcDhHXrC0vH7ufTtERjCBIU+ilfjNQAFJuOmD0dD1zxF9iIQlaozNf9DCOklGJWkOEQzn+YWyYinZJdX3JvRpwWSaVQy709dOPNKw7FtVF4NuWkUDz9ajGEZRB0+LPlbN/sqeMkodFoQoV5ogSSZVqX3TzDfnbVIUX2A79yoraSjd4kKftAxKclpIaxu4356W5nnuk9Q6n0uBiFZNCDKK5oJKY3IWAyhN9rZXlu8f/W8JccAQXmwPS8W4AHVnRiFsSgFjKytwKSC8NfTcDnSJJXYMAXvLj8PCWfWq38+9iCYi6ByC3PdvS/Hr7VEf4nxnIRStCX8e7h/9IeYiBeqGx1prLw2MLBwRdBCqVNhobEa6zyx4xXoInGS8qhqseqGAdGjOQuMGWDSLVQmZdi2kjoHnf0/Yz1C4caKM6GaMKl9TvbauHAi78c+Av7XnNCI=
      on:
        tags: true
      tag: latest
      skip_cleanup: true
  - stage: images
    node_js: '10'
    services:
        - docker
    script: node .travis/release-images.js
